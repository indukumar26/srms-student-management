<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Management System</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f6f9; color: #333; }
    
    /* CONTAINER */
    .container { max-width: 1100px; margin: 30px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
    
    /* HEADER */
    .header-row { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 25px; }
    .header-row img { height: 60px; }
    .header-row h1 { margin: 0; color: #2c3e50; font-size: 28px; }

    /* LOGIN SCREEN */
    .login-box { max-width: 350px; margin: 50px auto; padding: 40px; border: 1px solid #ddd; border-radius: 10px; background: white; text-align: center; }
    .login-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }

    /* DASHBOARD NAV */
    .top-bar { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 2px solid #eee; margin-bottom: 20px; }
    
    .nav-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .nav-btn {
      padding: 10px 20px; border: none; background: #e9ecef; border-radius: 30px; 
      cursor: pointer; font-weight: 600; color: #555; transition: 0.2s;
    }
    .nav-btn.active { background: #007bff; color: white; box-shadow: 0 4px 6px rgba(0,123,255,0.3); }
    .nav-btn:hover:not(.active) { background: #dbe0e6; }

    /* FORMS & SECTIONS */
    .section-box { animation: fadeIn 0.4s ease; padding: 10px; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px; }
    
    .input-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: #666; text-transform: uppercase; }
    .input-group input, .input-group select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 15px; }
    
    /* TABLES */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    th { background: #007bff; color: white; padding: 12px; text-align: left; }
    td { border-bottom: 1px solid #eee; padding: 10px; }
    tr:hover { background: #f1f1f1; }

    /* BUTTONS */
    .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
    .btn-primary { background: #007bff; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-warning { background: #ffc107; color: #333; }
    
    /* UTILITY */
    .hidden { display: none !important; }
    .msg-box { margin-top: 15px; padding: 15px; border-radius: 5px; text-align: center; display: none; font-weight: bold; }
    .msg-success { background: #d4edda; color: #155724; display: block !important; border: 1px solid #c3e6cb; }
    .msg-error { background: #f8d7da; color: #721c24; display: block !important; border: 1px solid #f5c6cb; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<div class="container">
  
  <div class="header-row">
    <img src="srmlogo.png" alt="Logo" onerror="this.style.display='none'"> 
    <h1>Student Management System</h1>
  </div>

  <div id="login-screen" class="login-box">
    <h2 style="margin-bottom: 20px; color: #007bff;">Admin/Staff Login</h2>
    <input type="text" id="u" class="login-input" placeholder="Username (pavan)">
    <input type="password" id="p" class="login-input" placeholder="Password (pavan@143)">
    <select id="role" class="login-input">
      <option value="admin">Admin</option>
      <option value="staff">Staff</option>
    </select>
    <button class="btn btn-primary" style="width:100%" onclick="login()">Login</button>
    <div id="login-msg" class="msg-box"></div>
  </div>

  <div id="dashboard" class="hidden">
    
    <div class="top-bar">
      <div style="display:flex; align-items:center; gap:10px;">
        <h4 style="margin:0; color:#555;">Student Records</h4>
        <span style="color:#ccc">|</span>
        <button class="btn btn-warning" onclick="clearAllData()" style="font-size:12px; padding: 8px 12px;">Reset Data</button>
        <span id="data-status-msg" style="font-size:13px; color:green; font-weight:bold;"></span>
      </div>
      <div>
        <span>Role: <b id="display-role" style="text-transform: capitalize; color: #007bff; margin-right: 15px;"></b></span>
        <button class="btn btn-danger" onclick="logout()">Logout</button>
      </div>
    </div>

    <div class="nav-tabs">
      <button class="nav-btn active" onclick="showSection('sec-view', this)">View Students</button>
      <button class="nav-btn" onclick="showSection('sec-add', this)">Add Student</button>
      <button class="nav-btn" onclick="showSection('sec-search', this)">Search</button>
      <button class="nav-btn" onclick="showSection('sec-update', this)">Update</button>
      <button class="nav-btn" id="btn-delete-tab" onclick="showSection('sec-delete', this)">Delete</button>
    </div>

    <div id="sec-view" class="section-box">
      <div style="display:flex; justify-content:space-between;">
        <h3>All Students List</h3>
        <button class="btn btn-primary" onclick="renderTable()">Refresh List</button>
      </div>
      <div style="max-height: 400px; overflow-y: auto; margin-top:10px; border:1px solid #eee;">
        <table>
          <thead style="position: sticky; top: 0;">
            <tr><th>Reg No</th><th>Name</th><th>Branch</th><th>Year</th><th>Section</th><th>CGPA</th></tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </div>

    <div id="sec-add" class="section-box hidden">
      <h3>Add New Student</h3>
      <div id="add-step-1" style="max-width: 500px; margin: 20px auto; text-align: center; border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
        <p>Enter Registration Number to check if student exists:</p>
        <input type="text" id="check-add-reg" placeholder="e.g. AP25..." style="padding:10px; width:70%; border:1px solid #ccc; border-radius:4px;">
        <button class="btn btn-primary" style="margin-top:10px;" onclick="checkBeforeAdd()">Check Availability</button>
        <div id="add-check-msg" class="msg-box"></div>
      </div>

      <div id="add-step-2" class="hidden">
        <div style="background: #e9ecef; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
           <strong>Adding Record For:</strong> <span id="display-new-reg" style="color:#007bff; font-weight:bold;"></span>
        </div>
        <div class="form-grid">
          <div class="input-group"><label>Full Name</label><input type="text" id="add-name"></div>
          <div class="input-group"><label>Section</label><input type="text" id="add-section"></div>
          <div class="input-group">
            <label>Branch</label>
            <select id="add-branch">
              <option value="CSE">CSE</option><option value="ECE">ECE</option>
              <option value="EEE">EEE</option><option value="MECH">MECH</option><option value="CIVIL">CIVIL</option>
            </select>
          </div>
          <div class="input-group">
            <label>Year</label>
            <select id="add-year">
              <option value="1 Year">1 Year</option><option value="2 Year">2 Year</option>
              <option value="3 Year">3 Year</option><option value="4 Year">4 Year</option>
            </select>
          </div>
          <div class="input-group"><label>CGPA</label><input type="number" id="add-cgpa" step="0.01"></div>
        </div>
        <div style="margin-top:20px; text-align:right;">
          <button class="btn btn-secondary" onclick="resetAddForm()">Cancel</button>
          <button class="btn btn-success" onclick="saveNewStudent()">Save Student</button>
        </div>
      </div>
    </div>

    <div id="sec-search" class="section-box hidden">
      <h3>Search Student</h3>
      <div style="margin-bottom: 20px;">
        <input type="text" id="search-input" placeholder="Enter Registration No..." style="padding:10px; width:300px; border:1px solid #ccc; border-radius:4px;">
        <button class="btn btn-primary" onclick="performSearch()">Search</button>
      </div>
      <div id="search-result" style="border:1px solid #ddd; padding:15px; border-radius:5px;" class="hidden"></div>
    </div>

    <div id="sec-update" class="section-box hidden">
      <h3>Update Student Details</h3>
      <div style="margin-bottom: 20px;">
        <input type="text" id="update-search-reg" placeholder="Enter Reg No to Update..." style="padding:10px; width:300px;">
        <button class="btn btn-warning" onclick="loadForUpdate()">Load Details</button>
      </div>
      <div id="update-form" class="hidden" style="border-top:2px solid #eee; padding-top:20px;">
        <div class="form-grid">
          <div class="input-group"><label>Name</label><input type="text" id="up-name"></div>
          <div class="input-group"><label>Section</label><input type="text" id="up-section"></div>
          <div class="input-group"><label>Branch</label>
            <select id="up-branch"><option value="CSE">CSE</option><option value="ECE">ECE</option><option value="EEE">EEE</option><option value="MECH">MECH</option></select>
          </div>
          <div class="input-group"><label>Year</label>
            <select id="up-year"><option value="1 Year">1 Year</option><option value="2 Year">2 Year</option><option value="3 Year">3 Year</option><option value="4 Year">4 Year</option></select>
          </div>
          <div class="input-group"><label>CGPA</label><input type="number" id="up-cgpa" step="0.01"></div>
        </div>
        <button class="btn btn-primary" style="margin-top:20px;" onclick="saveUpdate()">Save Changes</button>
      </div>
      <div id="update-msg" class="msg-box"></div>
    </div>

    <div id="sec-delete" class="section-box hidden">
      <h3 style="color:#dc3545;">Delete Student Record</h3>
      <p style="color:#666; margin-bottom:15px;">Enter the Registration Number of the student you want to delete.</p>
      <div style="display: flex; gap: 10px; max-width: 500px;">
        <input type="text" id="delete-reg" placeholder="Enter Reg No (e.g. AP25...)" style="flex:1; padding:10px; border:1px solid #dc3545; border-radius:4px;">
        <button class="btn btn-danger" onclick="performDelete()">Delete</button>
      </div>
      <div id="delete-msg" class="msg-box"></div>
    </div>

  </div>
</div>

<script>
  // --- CONFIG ---
  const USERS = [
    { u: 'pavan', p: 'pavan@143', r: 'admin' },
    { u: 'staff', p: 'staff@123', r: 'staff' }
  ];

  // --- 1. DATA INITIALIZATION LOGIC ---
  let students = JSON.parse(localStorage.getItem('studentData')) || [];

  // Function to Generate 500 Dummy Records (Simulating students_500_with_years.csv)
  function generateDefaultData() {
    const branches = ['CSE', 'ECE', 'EEE', 'MECH', 'CIVIL'];
    const years = ['1 Year', '2 Year', '3 Year', '4 Year'];
    const sections = ['A', 'B', 'C', 'D'];
    const firstNames = ['Aarav', 'Vihaan', 'Aditya', 'Reyansh', 'Arjun', 'Sai', 'Ishaan', 'Siddharth', 'Vikram', 'Rohan', 'Karthik', 'Ananya', 'Diya', 'Pooja', 'Riya', 'Sneha', 'Meera', 'Nisha', 'Rahul', 'Varun'];
    const lastNames = ['Sharma', 'Verma', 'Kumar', 'Gupta', 'Singh', 'Krishna', 'Reddy', 'Rao', 'Malhotra', 'Mehta', 'Nair', 'Iyer', 'Patel', 'Joshi', 'Choudhury', 'Kapoor', 'Saxena', 'Agarwal', 'Deshmukh', 'Pillai'];

    const newStudents = [];

    // Generate 500 records: AP2511001 to AP2511500
    for(let i = 1; i <= 500; i++) {
      const regNo = `AP2511${String(i).padStart(3, '0')}`; // e.g., AP2511001
      const randName = firstNames[i % firstNames.length] + " " + lastNames[i % lastNames.length];
      const randBranch = branches[i % branches.length];
      const randYear = years[i % years.length];
      const randSec = sections[i % sections.length];
      const randCGPA = (6.0 + Math.random() * 4.0).toFixed(2); // Random CGPA between 6.00 and 10.00

      newStudents.push({
        reg: regNo,
        name: randName,
        branch: randBranch,
        year: randYear,
        section: randSec,
        cgpa: randCGPA
      });
    }
    return newStudents;
  }

  let currentUser = null;

  // --- LOGIN ---
  function login() {
    const u = document.getElementById('u').value.trim();
    const p = document.getElementById('p').value.trim();
    const r = document.getElementById('role').value;
    const msg = document.getElementById('login-msg');

    const validUser = USERS.find(user => user.u === u && user.p === p && user.r === r);

    if(validUser) {
      currentUser = validUser;
      
      // *** AUTO-LOAD DATA IF EMPTY ***
      if(students.length === 0) {
        students = generateDefaultData();
        localStorage.setItem('studentData', JSON.stringify(students));
        document.getElementById('data-status-msg').textContent = "Loaded 500 records automatically.";
      } else {
        document.getElementById('data-status-msg').textContent = `Loaded ${students.length} existing records.`;
      }

      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      document.getElementById('display-role').textContent = r;
      
      if(r === 'staff') {
        document.getElementById('btn-delete-tab').classList.add('hidden');
      } else {
        document.getElementById('btn-delete-tab').classList.remove('hidden');
      }
      
      showSection('sec-view', document.querySelector('.nav-btn'));
      renderTable();
    } else {
      msg.textContent = "Invalid Credentials!";
      msg.className = "msg-box msg-error";
    }
  }

  function logout() { location.reload(); }

  // --- NAVIGATION ---
  function showSection(id, btn) {
    document.querySelectorAll('.section-box').forEach(s => s.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.msg-box').forEach(m => { m.style.display = 'none'; m.textContent = ''; m.className = 'msg-box'; });
  }

  // --- UTILS ---
  function clearAllData() {
    if(confirm("Are you sure? This will delete ALL student records.")) {
      localStorage.removeItem('studentData');
      students = [];
      renderTable();
      document.getElementById('data-status-msg').textContent = "Data Cleared.";
      alert("All data cleared. Log out and back in to restore default data.");
    }
  }

  // --- VIEW ---
  function renderTable() {
    const tbody = document.getElementById('table-body');
    tbody.innerHTML = "";
    if(students.length === 0) { tbody.innerHTML = "<tr><td colspan='6' style='text-align:center'>No Data</td></tr>"; return; }
    
    // Sort slightly for better view
    students.forEach(s => {
      const r = s.reg || '-';
      const n = s.name || '-';
      tbody.innerHTML += `<tr><td><b>${r}</b></td><td>${n}</td><td>${s.branch}</td><td>${s.year}</td><td>${s.section}</td><td>${s.cgpa}</td></tr>`;
    });
  }

  // --- ADD STUDENT ---
  let pendingReg = "";

  function checkBeforeAdd() {
    const reg = document.getElementById('check-add-reg').value.trim();
    const msg = document.getElementById('add-check-msg');
    if(!reg) { msg.textContent = "Enter Reg No"; msg.className = "msg-box msg-error"; return; }

    const exists = students.some(s => s.reg && s.reg.toLowerCase() === reg.toLowerCase());
    if(exists) {
      msg.textContent = `ID ${reg} already exists!`; msg.className = "msg-box msg-error";
      document.getElementById('add-step-2').classList.add('hidden');
    } else {
      msg.style.display = "none"; pendingReg = reg;
      document.getElementById('display-new-reg').textContent = reg;
      document.getElementById('add-step-1').classList.add('hidden');
      document.getElementById('add-step-2').classList.remove('hidden');
    }
  }

  function saveNewStudent() {
    const name = document.getElementById('add-name').value;
    const section = document.getElementById('add-section').value;
    const branch = document.getElementById('add-branch').value;
    const year = document.getElementById('add-year').value;
    const cgpa = document.getElementById('add-cgpa').value;

    if(!name || !branch || !year) { alert("Fill all details"); return; }
    students.push({ reg: pendingReg, name, section, branch, year, cgpa });
    localStorage.setItem('studentData', JSON.stringify(students));
    alert("Student Added!"); resetAddForm();
    renderTable(); // Update list immediately
  }

  function resetAddForm() {
    document.getElementById('add-step-2').classList.add('hidden');
    document.getElementById('add-step-1').classList.remove('hidden');
    document.getElementById('check-add-reg').value = "";
    document.getElementById('add-name').value = "";
    document.getElementById('add-cgpa').value = "";
  }

  // --- SEARCH & UPDATE & DELETE ---
  function performSearch() {
    const reg = document.getElementById('search-input').value.trim().toLowerCase();
    const resBox = document.getElementById('search-result');
    const s = students.find(st => st.reg && st.reg.toLowerCase() === reg);
    resBox.classList.remove('hidden');
    resBox.innerHTML = s ? `<h4 style="color:green; margin:0">Found:</h4> <p><b>${s.reg}</b> - ${s.name} | ${s.branch} | ${s.year} | CGPA: ${s.cgpa}</p>` : `<p style="color:red">Student Not Found.</p>`;
  }

  function loadForUpdate() {
    const reg = document.getElementById('update-search-reg').value.trim();
    const s = students.find(st => st.reg && st.reg.toLowerCase() === reg.toLowerCase());
    const msg = document.getElementById('update-msg');
    if(s) {
      document.getElementById('update-form').classList.remove('hidden');
      document.getElementById('up-name').value = s.name;
      document.getElementById('up-section').value = s.section;
      document.getElementById('up-branch').value = s.branch;
      document.getElementById('up-year').value = s.year;
      document.getElementById('up-cgpa').value = s.cgpa;
      msg.style.display = 'none';
    } else {
      document.getElementById('update-form').classList.add('hidden');
      msg.textContent = "Not Found!"; msg.className = "msg-box msg-error";
    }
  }

  function saveUpdate() {
    const reg = document.getElementById('update-search-reg').value.trim();
    const index = students.findIndex(s => s.reg && s.reg.toLowerCase() === reg.toLowerCase());
    if(index !== -1) {
      students[index].name = document.getElementById('up-name').value;
      students[index].section = document.getElementById('up-section').value;
      students[index].branch = document.getElementById('up-branch').value;
      students[index].year = document.getElementById('up-year').value;
      students[index].cgpa = document.getElementById('up-cgpa').value;
      localStorage.setItem('studentData', JSON.stringify(students));
      document.getElementById('update-msg').textContent = "Updated!"; document.getElementById('update-msg').className = "msg-box msg-success";
      document.getElementById('update-form').classList.add('hidden');
      renderTable();
    }
  }

  function performDelete() {
    const regInput = document.getElementById('delete-reg').value.trim();
    const msg = document.getElementById('delete-msg');
    if(!regInput) { msg.textContent = "Enter Reg No"; msg.className = "msg-box msg-error"; return; }
    
    const s = students.find(st => st.reg && st.reg.toLowerCase() === regInput.toLowerCase());
    if(s) {
      if(confirm(`Delete ${s.name}?`)) {
        students = students.filter(st => st.reg.toLowerCase() !== regInput.toLowerCase());
        localStorage.setItem('studentData', JSON.stringify(students));
        msg.textContent = "Deleted."; msg.className = "msg-box msg-success";
        renderTable();
      }
    } else {
      msg.textContent = "Not Found."; msg.className = "msg-box msg-error";
    }
  }
</script>
</body>
</html>